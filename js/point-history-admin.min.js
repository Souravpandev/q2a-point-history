!function(o){"use strict";let s=[],e=[];function r(e){return e.avatar&&""!==e.avatar.trim()?e.avatar:`<div class="avatar-initial">${e.handle.charAt(0).toUpperCase()}</div>`}function i(e){o("#qa-admin-timeline-container").html(`
    <div class="qa-admin-error">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <h3>Error</h3>
        <p>${d(e)}</p>
    </div>
`)}function d(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}o(document).ready(function(){o("#user-select option").each(function(){var e=o(this),t=e.val();t&&(e=e.text().match(/^(.+?) \((\d+) points\)$/))&&s.push({userid:t,handle:e[1],points:parseInt(e[2])})}),e=[...s],o("#user-select").on("change",function(){var e=o(this).val();e?(o("#qa-admin-timeline-container").html(`
    <div class="qa-admin-loading">
        <div class="qa-loading-spinner"></div>
        <p>Loading point history...</p>
    </div>
`),o.ajax({url:window.location.href,method:"POST",data:{ajax_get_user_history:e},dataType:"json",success:function(e){if(e.user&&e.history){var n=e.user,e=e.history,t=o("#qa-admin-timeline-container");if(e&&0!==e.length){let s=`
    <div class="qa-admin-user-info">
        <div class="qa-admin-user-avatar">
            ${r(n)}
        </div>
        <div class="qa-admin-user-details">
            <h2>${d(n.handle)}</h2>
            <p class="qa-admin-user-points">Total Points: ${n.points}</p>
            <p class="qa-admin-user-level">Level: ${{0:"Basic User",10:"Editor",20:"Moderator",100:"Administrator",120:"Super Administrator"}[n.level]||"Basic User"}</p>
        </div>
    </div>
    
    <ul class="timeline" id="qa-admin-timeline">`;e.forEach((e,t)=>{e.points;var i=0<=e.points?"+":"",a={question_posted:"opened",answer_posted:"commented",comment_posted:"commented",vote_given:"assigned",best_answer:"closed",bonus_points:"opened",registration:"opened"}[e.activity_type]||"opened";s+=`
        <li class="timeline-item" data-status="${a}" data-index="${t}">
            <div class="timeline-avatar">
                ${r(n)}
            </div>
            
            <div class="timeline-header">
                <span class="timeline-title">${d(n.handle)}</span>
                <span class="timeline-action">earned ${i}${e.points} points</span>
            </div>
            
            <div class="timeline-content">
                ${d(e.description)}
                <span class="timeline-date">${a=e.created,a=new Date(a),t=new Date,t=Math.abs(t-a),t=Math.ceil(t/864e5),1===t?"Yesterday":t<7?t+" days ago":a.toLocaleDateString()}</span>
            </div>
        </li>`}),s+="</ul>",t.html(s),o(".timeline-item").each(function(e){const t=o(this);t.css({opacity:"0",transform:"translateY(20px)","animation-delay":.1*e+"s"}),setTimeout(()=>{t.css({opacity:"1",transform:"translateY(0)",animation:"slideIn 0.4s ease forwards"})},100*e)})}else t.html(`
        <div class="qa-admin-no-history">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            <h3>No Point History Found</h3>
            <p>This user has no point history recorded yet.</p>
        </div>
    `)}else i("Failed to load user data")},error:function(){i("Failed to load point history. Please try again.")}})):o("#qa-admin-timeline-container").html(`
    <div class="qa-admin-placeholder">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <h3>Select a user to view their point history</h3>
        <p>Choose a user from the dropdown above to see their complete timeline</p>
    </div>
`)}),o("#user-search").on("input",function(){var t=o(this).val().toLowerCase();e=t?s.filter(e=>e.handle.toLowerCase().includes(t)):[...s];{const i=o("#user-select"),a=i.val();i.find("option:not(:first)").remove(),e.forEach(e=>{e=o("<option>").val(e.userid).text(`${e.handle} (${e.points} points)`),i.append(e)}),a&&e.some(e=>e.userid===a)&&i.val(a)}}),o("#user-search").on("keydown",function(e){"Enter"===e.key&&e.preventDefault()}),o("#user-search").on("focus",function(){o(this).parent().addClass("focused")}),o("#user-search").on("blur",function(){setTimeout(()=>{o(this).parent().removeClass("focused")},200)})})}(jQuery);