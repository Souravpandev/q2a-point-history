!function(){"use strict";function a(t){return new Date(t).toISOString().split("T")[0]}function t(){document.querySelectorAll("[data-tooltip]").forEach(t=>{t.addEventListener("mouseenter",e),t.addEventListener("mouseleave",o)})}function e(t){var e=document.createElement("div"),o=(e.className="qa-tooltip",e.textContent=t.target.getAttribute("data-tooltip"),e.style.cssText=`
    position: absolute;
    background: #2c3e50;
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 1000;
    pointer-events: none;
    white-space: nowrap;
`,document.body.appendChild(e),t.target.getBoundingClientRect());e.style.left=o.left+o.width/2-e.offsetWidth/2+"px",e.style.top=o.top-e.offsetHeight-8+"px",t.target._tooltip=e}function o(t){t.target._tooltip&&(t.target._tooltip.remove(),t.target._tooltip=null)}window.exportPointHistory=function(i){e=window.location.pathname.split("/");var t,e=-1!==(t=e.indexOf("point-history"))&&e[t+1]?e[t+1]:null;if(e){const o=document.querySelectorAll(".qa-point-export-csv, .qa-point-export-json");o.forEach(t=>{t.disabled=!0,t.textContent="Exporting..."}),async function(t,e){if((t=await fetch("/qa-plugin/q2a-point-history/export.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`userhandle=${encodeURIComponent(t)}&format=${e}&action=export`})).ok)return t.json();throw new Error("HTTP error! status: "+t.status)}(e,i).then(t=>{var e,o,n;"csv"===i?(e=t).activities&&0!==e.activities.length?(n=[["Date","Activity","Points","Post ID","Description"].join(","),...e.activities.map(t=>[a(t.created),t.activity_type,t.points,t.postid||"",`"${t.description.replace(/"/g,'""')}"`].join(","))].join("\n"),n=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),n=URL.createObjectURL(n),o.setAttribute("href",n),o.setAttribute("download",`point-history-${e.userhandle}-${a(new Date)}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):alert("No data to export."):"json"===i&&((n=t).activities&&0!==n.activities.length?(e=JSON.stringify(n,null,2),e=new Blob([e],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),e=URL.createObjectURL(e),o.setAttribute("href",e),o.setAttribute("download",`point-history-${n.userhandle}-${a(new Date)}.json`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):alert("No data to export."))}).catch(t=>{console.error("Export failed:",t),alert("Export failed. Please try again.")}).finally(()=>{o.forEach(t=>{t.disabled=!1,t.classList.contains("qa-point-export-csv")?t.textContent="Export as CSV":t.textContent="Export as JSON"})})}else alert("Unable to determine user handle for export.")},document.addEventListener("DOMContentLoaded",function(){function e(t,e,o){"undefined"!=typeof qa_ga&&qa_ga.trackEvent&&qa_ga.trackEvent(t,e,o)}document.querySelectorAll(".qa-pagination-page, .qa-pagination-prev, .qa-pagination-next").forEach(t=>{t.addEventListener("click",function(t){window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".qa-point-history-activity-item").forEach(t=>{t.addEventListener("mouseenter",function(){this.style.transform="translateX(4px)"}),t.addEventListener("mouseleave",function(){this.style.transform="translateX(0)"})}),"undefined"!=typeof qa_ga&&(document.addEventListener("click",function(t){t.target.classList.contains("qa-point-export-csv")?e("Point History","Export","CSV"):t.target.classList.contains("qa-point-export-json")&&e("Point History","Export","JSON")}),document.addEventListener("click",function(t){(t.target.classList.contains("qa-pagination-page")||t.target.classList.contains("qa-pagination-prev")||t.target.classList.contains("qa-pagination-next"))&&e("Point History","Navigation","Pagination")}))}),document.addEventListener("keydown",function(t){if((t.ctrlKey||t.metaKey)&&"e"===t.key){t.preventDefault();const e=document.querySelector(".qa-point-history-export");e&&(e.scrollIntoView({behavior:"smooth"}),e.style.outline="2px solid #3498db",setTimeout(()=>{e.style.outline="none"},2e3))}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}();